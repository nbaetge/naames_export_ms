---
title: "Processed Export"
author: "Nicholas Baetge"
date: "2/7/2020"
output: github_document
---

# Intro

This document is shows how nitrate drawdown and NCP were calculated from the processed bottle file

```{r include=FALSE}
library(tidyverse)
library(knitr)
library(googledrive)
library(googlesheets4)
library(data.table)  
#for interpolations
library(zoo) 
#for integrations
library(oce) 
library(scales)
library(gridExtra)
#for time
library(lubridate)

custom_theme <- function() {
  theme_test(base_size=30) %+replace%
    theme(legend.position="top",
          legend.title = element_blank(),
          legend.spacing.x = unit(0.5,"cm"),
          legend.background = element_rect(fill = "transparent",colour = NA),
          legend.key = element_rect(fill = "transparent",colour = NA),
          panel.background = element_rect(fill = "transparent",colour = NA),
          plot.background = element_rect(fill = "transparent",colour = NA)) 
}

levels = c("GS/Sargasso", "Subtropical", "Temperate", "Subpolar",  "AT39-6", "AT34", "AT38", "AT32", "Early Spring", "Late Spring", "Early Autumn", "Late Autumn")

custom.colors <- c("AT39" = "#377EB8", "AT34" = "#4DAF4A", "AT38" = "#E41A1C", "AT32" = "#FF7F00", "Temperate" = "#A6CEE3", "Subpolar" = "#377EB8", "Subtropical" = "#FB9A99", "GS/Sargasso" = "#E41A1C", "Early Spring" = "#377EB8", "Late Spring" = "#4DAF4A","Early Autumn" = "#E41A1C", "Summer" = "#E41A1C", "Late Autumn" = "#FF7F00", "Gv2_2019" = "#377EB8", "WOA18_MN" = "#4DAF4A", "WOA18_AN" = "#E41A1C")


```

# Import Data 

```{r}
processed_bf <-  read_rds("~/Google Drive File Stream/Shared drives/NAAMES_Carlson/DATA/FINAL/MANUSCRIPT_DATA/Export_MS/Output/processed_bf.2.2020.rds")

```

# Subset Nitrogen and Phytoplankton Data

```{r warning = FALSE}
#select nutrient and phytoplankton data for N2 and N3 
subset <- processed_bf %>% 
  #omitting CampCN 98 because only measurements at 5 m and below 1500 m were taken. the interpolated values for this cast were as a result, not reliable
  filter(Cruise %in% c("AT34", "AT38", "AT39-6"),
         !CampCN == 98) %>% 
  #the multiday N2S4 drifted from the 48˚Lat bin to the 47˚Lat bin, but was a lagrangian study (followed float), so we'll denote all casts within station 4 as being in the 48˚N bin
  mutate(degree_bin = ifelse(Cruise == "AT34" & Station == "4", 48, degree_bin),
         Max_MLD = ifelse(Cruise == "AT34" & Station == "4", 508, Max_MLD),) %>% 
  select(Cruise, Latitude, Longitude, Date, degree_bin, Station, Season, Subregion,  CampCN, 
         Chl_max, Phyto_max, Max_MLD,  Target_Z,  interp_DOC, interp_N_N, interp_NO2, interp_SiO4,  interp_Pro_Influx, interp_Syn_Influx, interp_Pico_Influx, interp_Nano_Influx, Density00, Density11) %>% 
  rename(Pro = interp_Pro_Influx, 
         Syn = interp_Syn_Influx, 
         Pico = interp_Pico_Influx, 
         Nano = interp_Nano_Influx) %>% 
  #add column that averages the density measurements
  mutate(p = (Density00 + Density11)/2) %>%
  distinct() %>% 
  #calculate nitrate for each cast, replacing values less than 0 with 0
  group_by(CampCN) %>% 
  mutate(N = interp_N_N - interp_NO2,
         N = ifelse(N < 0, 0, N),
         p5 = ifelse(Target_Z == 5, p, NA),
         p10 = ifelse(Target_Z == 10, p, NA),
         p = ifelse(Target_Z == 0, max(p5, na.rm = T) , p),
         p = ifelse(Target_Z == 0 | is.na(p), max(p10, na.rm = T) , p)) %>% 
  select(-c(interp_N_N, interp_NO2, Density00, Density11, p5, p10)) %>% 
  ungroup() 
```

# Create Composite Station Casts

## Average Chl Max and Phytoplankton Max

Since we're interested in how stocks of nutrients vary over the 100 m, chl max, and phytoplankton max depth horizons, we'll need a station average for each of the chl and phytoplankton max depths. We'll interpolate variables to those depths

```{r warning = FALSE, message = FALSE}
ave_phyto <- subset %>%
  group_by(Cruise, Station) %>%
  mutate(ave_chlmax = mean(Chl_max), 
         sd_chlmax = sd(Chl_max),
         ave_pmax = mean(Phyto_max),
         sd_pmax = sd(Phyto_max)) %>% 
  mutate_at(vars(ave_chlmax:sd_pmax), round) %>% 
  ungroup()

#split the df by CampCN  
add_phyto.list <- split(ave_phyto, ave_phyto$CampCN)

#create a function to add an empty row to each cast, then add the max MLD to the Target Z column 
add.func <- function(morty){
  morty[nrow(morty) + 1,] <- NA
  morty$Target_Z[is.na(morty$Target_Z)] <- morty$ave_chlmax
  rick <- morty %>% 
    fill(., Cruise:Max_MLD, .direction = c("updown")) %>% 
    fill(., ave_chlmax:sd_pmax, .direction = c("updown")) %>% 
    arrange(CampCN, Target_Z)
  
  rick[nrow(rick) + 1,] <- NA
  rick$Target_Z[is.na(rick$Target_Z)] <- rick$ave_pmax
   schwifty <- rick %>% 
     fill(., Cruise:Max_MLD, .direction = c("updown")) %>% 
      fill(., ave_chlmax:sd_pmax, .direction = c("updown")) %>% 
    arrange(CampCN, Target_Z)

  }

#apply function to list 
added_phyto.list <- lapply(add_phyto.list, add.func)


#save the list as a data frame 
added_phyto.df <- plyr::ldply(added_phyto.list, data.frame) %>% 
  group_by(CampCN) %>% 
  distinct(., Target_Z, .keep_all = T) %>% 
  select(-.id) %>% 
  ungroup() %>% 
  filter(!Target_Z == "-Inf")


#split the data frame into lists based on the campaign cast number
to_interpolate.list <- split(added_phyto.df, added_phyto.df$CampCN)

#create a function that will linearly interpolate each VOI according to the depth intervals of the casts 
interpolate.func <- function(copper) {
to_interpolate.df <- copper %>% 
  select(Target_Z:ncol(.)) %>% 
  zoo(., order.by = .$Target_Z) 

interp_doc <- as.numeric(na.approx(to_interpolate.df$interp_DOC, na.rm = F))
interp_Si <- as.numeric(na.approx(to_interpolate.df$interp_SiO4, na.rm = F))
interp_N <- as.numeric(na.approx(to_interpolate.df$N, na.rm = F))
interp_p <- as.numeric(na.approx(to_interpolate.df$p, na.rm = F))
interp_Pro <- as.numeric(na.approx(to_interpolate.df$Pro, na.rm = F))
interp_Syn <- as.numeric(na.approx(to_interpolate.df$Syn, na.rm = F))
interp_Pico <- as.numeric(na.approx(to_interpolate.df$Pico, na.rm = F))
interp_Nano <- as.numeric(na.approx(to_interpolate.df$Nano, na.rm = F))
Target_Z <- to_interpolate.df$Target_Z
interpolations.df <- data.frame(Target_Z, interp_doc, interp_Si,interp_N, interp_Pro, interp_Syn,
                                interp_Pico, interp_Nano, interp_p)
}

#apply function to list 
interpolations.list <- lapply(to_interpolate.list, interpolate.func)

#save the list as a data frame 
interpolations.df <- plyr::ldply(interpolations.list, data.frame) %>% 
  rename(., CampCN = .id) 

#combine the interpolated and non-interpolated data frames
interpolations.df$CampCN <- as.numeric(interpolations.df$CampCN)
interpolated.df <- right_join(ave_phyto, interpolations.df) %>% 
  select(Cruise:Max_MLD, ave_chlmax:sd_pmax, Target_Z, interp_p, interp_N, interp_doc, interp_Si, interp_Pro:interp_Nano ) %>% 
  fill(Cruise:sd_pmax, .direction = "updown")

```

## Average Variable Values

```{r}
composite <- interpolated.df %>%
  group_by(Cruise, Station, Target_Z) %>% 
  mutate(ave_p = mean(interp_p, na.rm = T),
         sd_p = sd(interp_p, na.rm = T),
         ave_N = mean(interp_N, na.rm = T),
         sd_N = sd(interp_N, na.rm = T),
         ave_DOC = mean(interp_doc, na.rm = T),
         sd_DOC = sd(interp_doc, na.rm = T),
         ave_Si = mean(interp_Si, na.rm = T),
         sd_Si = sd(interp_Si, na.rm = T),
         ave_Pro = mean(interp_Pro, na.rm = T),
         sd_Pro = sd(interp_Pro, na.rm = T),
         ave_Syn = mean(interp_Syn, na.rm = T),
         sd_Syn = sd(interp_Syn, na.rm = T),
         ave_Pico = mean(interp_Pico, na.rm = T),
         sd_Pico = sd(interp_Pico, na.rm = T),
         ave_Nano = mean(interp_Nano, na.rm = T),
         sd_Nano = sd(interp_Nano, na.rm = T),
  ) %>% 
  ungroup() %>% 
  group_by(Cruise, Station) %>% 
  mutate(ave_lat = round(mean(Latitude, na.rm = T), 2),
         ave_lon = round(mean(Longitude, na.rm = T), 2),
         ave_date = mean(Date)) %>% 
  select(Cruise, ave_lat, ave_lon, ave_date, degree_bin:Subregion, Max_MLD:Target_Z, ave_p:sd_Nano) %>%
  distinct() %>% 
  arrange(Cruise, Station, Target_Z) %>% 
  ungroup()

```


# Redistribute Nutrient Profiles

```{r}
redis_N <- composite %>% 
  drop_na(ave_N, ave_Si) %>% 
  group_by(Cruise, Station) %>% 
  filter(Target_Z <= Max_MLD) %>% 
  mutate(redis_N_vol = integrateTrapezoid(Target_Z, ave_N, type = "A")/Max_MLD,
         redis_Si_vol = integrateTrapezoid(Target_Z, ave_Si,type = "A")/Max_MLD) %>% 
  select(Cruise, Station,  degree_bin, redis_N_vol, redis_Si_vol) %>% 
  distinct() %>% 
  ungroup() %>% 
  #we want to apply the same depth normalized values from the summer cruise to the spring profiles, where there are overlapping latitudinal bins. 
  #there are stations in the latitudinal bins of 44, 48, and 50˚N for both cruises. 
  #because there are two stations at 44˚N within the summer cruise, we will apply the mean
  #redistribution value of that station to the 44˚N station of the spring cruise
  group_by(degree_bin) %>% 
  arrange(degree_bin) %>% 
  mutate(redis_N_vol = ifelse(Cruise == "AT34" & degree_bin %in% c(44,48,50), NA, redis_N_vol),
         redis_Si_vol = ifelse(Cruise == "AT34" & degree_bin %in% c(44,48,50), NA, redis_Si_vol),
         ave_redis_N = mean(redis_N_vol, na.rm = T),
         redis_N_vol = ifelse(is.na(redis_N_vol) & degree_bin == 44, ave_redis_N, redis_N_vol),
         ave_redis_Si = mean(redis_Si_vol, na.rm = T),
         redis_Si_vol = ifelse(is.na(redis_Si_vol) & degree_bin == 44, ave_redis_Si, redis_Si_vol)) %>% 
  select(-c(ave_redis_N, ave_redis_Si)) %>% 
  fill(redis_N_vol:redis_Si_vol, .direction = "updown") %>% 
  ungroup()
```

# Redistribute DOC Profiles

```{r}
redis_DOC <- composite %>% 
  drop_na(ave_DOC) %>% 
  group_by(Cruise, Station) %>% 
  filter(Target_Z <= Max_MLD) %>% 
  mutate(redis_DOC_vol = integrateTrapezoid(Target_Z, ave_DOC, type = "A")/Max_MLD) %>% 
  select(Cruise, Station,  degree_bin, redis_DOC_vol) %>% 
  distinct() %>% 
  ungroup() %>% 
  group_by(degree_bin) %>% 
  arrange(degree_bin) %>% 
  mutate(redis_DOC_vol = ifelse(Cruise == "AT34" & degree_bin %in% c(44,48,50), NA, redis_DOC_vol),
         ave_redis_DOC = mean(redis_DOC_vol, na.rm = T),
         redis_DOC_vol = ifelse(is.na(redis_DOC_vol) & degree_bin == 44, ave_redis_DOC, redis_DOC_vol)) %>% 
  select(-c(ave_redis_DOC)) %>% 
  fill(redis_DOC_vol, .direction = "updown") %>% 
  ungroup()
```

# Calculate Mixed Profile Areas

```{r message = FALSE}
redis_areas <- composite %>% 
  left_join(., redis_N) %>% 
  left_join(., redis_DOC) %>% 
  mutate(redis_N_area = redis_N_vol * Max_MLD,
         redis_N_100_area = redis_N_vol * 100,
         redis_N_cm_area = redis_N_vol * ave_chlmax,
         redis_N_phy_area = redis_N_vol * ave_pmax,
         redis_Si_area = redis_Si_vol * Max_MLD,
         redis_Si_100_area = redis_Si_vol * 100,
         redis_DOC_area = redis_DOC_vol * Max_MLD,
         redis_DOC_100_area = redis_DOC_vol * 100,
         redis_DOC_cm_area = redis_DOC_vol * ave_chlmax,
         redis_DOC_phy_area = redis_DOC_vol * ave_pmax,
         redis_DOC_100_maxmld_area = redis_DOC_vol * (Max_MLD - 100))
  
```

# Integrate Nutrient Profiles 

```{r}
int_N <- composite %>% 
  drop_na(ave_N, ave_Si) %>% 
  group_by(Cruise, Station) %>% 
  filter(Target_Z <= Max_MLD) %>%
   mutate(int_N_maxmld = integrateTrapezoid(Target_Z, ave_N,type = "A"),
         int_Si_maxmld = integrateTrapezoid(Target_Z, ave_Si,type = "A")) %>% 
  filter(Target_Z <= 100) %>% 
  mutate(int_N_100 = integrateTrapezoid(Target_Z, ave_N,type = "A"),
         int_N_100_vol = integrateTrapezoid(Target_Z, ave_N,type = "A")/100,
         int_Si_100 = integrateTrapezoid(Target_Z, ave_Si,type = "A"),
         int_Si_100_vol = integrateTrapezoid(Target_Z, ave_Si,type = "A")/100) %>% 
  filter(Target_Z <= ave_chlmax) %>% 
  mutate(int_N_cm = integrateTrapezoid(Target_Z, ave_N,type = "A"),
         int_N_cm_vol = integrateTrapezoid(Target_Z, ave_N,type = "A")/ave_chlmax) %>% 
  filter(Target_Z <= ave_pmax) %>% 
  mutate(int_N_phy = ifelse(!ave_pmax == 0, integrateTrapezoid(Target_Z, ave_N,type = "A"), NA),
         int_N_phy_vol = ifelse(!ave_pmax == 0, integrateTrapezoid(Target_Z, ave_N,type = "A")/ave_pmax, NA )) %>% 
  select(Cruise, Station,  degree_bin, int_N_maxmld:int_N_phy_vol) %>% 
  distinct() %>% 
  ungroup()
```

# Integrate DOC Profiles 

```{r}
int_DOC <- composite %>% 
  drop_na(ave_DOC) %>% 
  group_by(Cruise, Station) %>% 
  filter(Target_Z <= Max_MLD) %>%
   mutate(int_DOC_maxmld = integrateTrapezoid(Target_Z, ave_DOC,type = "A")) %>% 
  filter(Target_Z <= 100) %>% 
  mutate(int_DOC_100 = integrateTrapezoid(Target_Z, ave_DOC,type = "A"),
         int_DOC_100_vol = integrateTrapezoid(Target_Z, ave_DOC,type = "A")/100,
         int_DOC_100_maxmld = int_DOC_maxmld - int_DOC_100) %>% 
  filter(Target_Z <= ave_chlmax) %>% 
  mutate(int_DOC_cm = integrateTrapezoid(Target_Z, ave_DOC,type = "A"),
         int_DOC_cm_vol = integrateTrapezoid(Target_Z, ave_DOC,type = "A")/ave_chlmax) %>% 
  filter(Target_Z <= ave_pmax) %>% 
  mutate(int_DOC_phy = ifelse(!ave_pmax == 0, integrateTrapezoid(Target_Z, ave_DOC,type = "A"), NA),
         int_DOC_phy_vol = ifelse(!ave_pmax == 0, integrateTrapezoid(Target_Z, ave_DOC,type = "A")/ave_pmax, NA )) %>% 
  select(Cruise, Station,  degree_bin, int_DOC_maxmld:int_DOC_phy_vol) %>% 
  distinct() %>% 
  ungroup()
```

# Integrate Phytoplankton Profiles

```{r}
int_phyto <- composite %>% 
  group_by(Cruise, Station) %>% 
  mutate(Phyto = ave_Pro + ave_Syn + ave_Pico + ave_Nano) %>% 
  drop_na(Phyto) %>% 
  filter(Target_Z <= ave_chlmax) %>% 
  select(Cruise, Station, Target_Z, ave_chlmax, ave_pmax, ave_Pro, ave_Syn, ave_Pico, ave_Nano) %>% 
  mutate(int_Pro_cm_vol = ifelse(max(Target_Z) < ave_chlmax, NA, integrateTrapezoid(Target_Z, ave_Pro,type = "A")/ave_chlmax),
         int_Syn_cm_vol = ifelse(max(Target_Z) < ave_chlmax, NA, integrateTrapezoid(Target_Z, ave_Syn,type = "A")/ave_chlmax), 
          int_Pico_cm_vol =  ifelse(max(Target_Z) < ave_chlmax, NA, integrateTrapezoid(Target_Z, ave_Pico,type = "A")/ave_chlmax),
          int_Nano_cm_vol =  ifelse(max(Target_Z) < ave_chlmax, NA, integrateTrapezoid(Target_Z, ave_Nano,type = "A")/ave_chlmax)
  ) %>% 
  filter(Target_Z <= ave_pmax) %>% 
  mutate( int_Pro_phy_vol = ifelse(!ave_pmax == 0,  integrateTrapezoid(Target_Z, ave_Pro,type = "A")/ave_pmax, NA),
          int_Syn_phy_vol = ifelse(!ave_pmax == 0,  integrateTrapezoid(Target_Z, ave_Syn,type = "A")/ave_pmax, NA),
          int_Pico_phy_vol = ifelse(!ave_pmax == 0,  integrateTrapezoid(Target_Z, ave_Pico,type = "A")/ave_pmax, NA),
          int_Nano_phy_vol = ifelse(!ave_pmax == 0,  integrateTrapezoid(Target_Z, ave_Nano,type = "A")/ave_pmax, NA),
         ) %>% 
  select(Cruise, Station, int_Pro_cm_vol:int_Nano_phy_vol) %>%
  distinct() %>% 
  ungroup()
```

# Calculate ∆NO~3~, NCP, ∆SiO~4~, ∆DOC


```{r message = FALSE}
processed_export <- redis_areas %>% 
  left_join(., int_N) %>% 
  left_join(., int_DOC) %>% 
  left_join(., int_phyto) %>% 
  group_by(Cruise, Station) %>% 
  mutate(delta_N = redis_N_vol - ave_N,
         NCP_umol = delta_N * 6.6,
         delta_Si = redis_Si_vol - ave_Si,
         delta_DOC = ave_DOC - redis_DOC_vol,
         int_delta_N_100 = (redis_N_100_area - int_N_100)/1000,
         NCP_mol_100 = int_delta_N_100 * 6.6,
         int_delta_Si_100 = (redis_Si_100_area - int_Si_100)/1000,
         int_delta_N_cm = (redis_N_cm_area - int_N_cm)/1000,
         NCP_mol_cm = int_delta_N_cm * 6.6,
         int_delta_N_phy = (redis_N_phy_area - int_N_phy)/1000,
         NCP_mol_phy = int_delta_N_phy * 6.6,
         int_delta_DOC_100 = (int_DOC_100 - redis_DOC_100_area)/1000,
         int_delta_DOC_100_maxmld = (redis_DOC_100_maxmld_area - int_DOC_100_maxmld)/1000,
         int_delta_DOC_cm = (int_DOC_cm - redis_DOC_cm_area)/1000,
         int_delta_DOC_phy = (int_DOC_phy - redis_DOC_phy_area)/1000,
         doc_ncp = delta_DOC/NCP_umol,
         doc_ncp_100 = int_delta_DOC_100/NCP_mol_100,
         doc_ncp_cm = int_delta_DOC_cm/NCP_mol_cm,
         doc_ncp_phy = int_delta_DOC_phy/NCP_mol_phy,
         si_n_100 = int_delta_Si_100/int_delta_N_100,
         si_ncp_100 = int_delta_Si_100/NCP_mol_100
         ) %>% 
  ungroup()

processed_export[ is.na(processed_export) ] <- NA


#saveRDS(processed_export, "~/Google Drive File Stream/Shared Drives/NAAMES_Carlson/DATA/FINAL/MANUSCRIPT_DATA/Export_MS/Output/processed_export.rds")
```

# Plot Profiles 

## Nitrate

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 20, fig.align = "center", warning = FALSE}
n.plot <-  processed_export %>% 
  filter(Season == "Late Spring", 
         Target_Z %in% c(0, 5, 10, 25, 50, 75, 100, 150, 200, 300, 400, 500, 750)) %>% 
  mutate(bin_plot = paste(degree_bin, "˚N", sep = "")) %>% 
  ggplot(aes(x = Target_Z, y = ave_N, group = Station)) +
  geom_segment(aes( x = Max_MLD, xend = Max_MLD, y = min(ave_N), yend = max(ave_N), group = Station ), colour = "#377EB8", linetype = 3, size = 1.5 ) +
  geom_segment(aes(y = redis_N_vol, yend = redis_N_vol, x = 0, xend = Max_MLD, group = Station ), colour = "black", linetype = 2, size = 1.5, alpha = 0.7 ) +
  geom_segment(aes(x = 100, xend = 100, y = min(ave_N), yend = max(ave_N), group = Station), colour = "black", linetype = 3, size = 1.5) +
  geom_errorbar(aes(x = Target_Z, ymin = ave_N - sd_N, ymax = ave_N + sd_N)) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  labs(x = expression(italic(paste("Depth, m"))), y = expression(italic(paste("NO"[3],", µmol N L"^"-1"))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  guides(fill = F) +
  custom_theme() +
  facet_grid(Season~bin_plot+Station, scales = "free") +
  theme(panel.spacing.x = unit(1, "cm"),
        axis.text.x = element_text(angle = 90))

n.plot
```
```{r include = FALSE}
#ggsave("s1a.jpg", n.plot, device = "jpg",  width = 20, height = 8, path = "~/Desktop/Export_MS/Submission2/") 
```


```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 32, fig.align = "center", warning = FALSE}
n2.plot <-  processed_export %>% 
  filter(Season == "Early Autumn", 
         Target_Z %in% c(0, 5, 10, 25, 50, 75, 100, 150, 200, 300, 400, 500, 750)) %>% 
  mutate(bin_plot = paste(degree_bin, "˚N", sep = "")) %>% 
  ggplot(aes(x = Target_Z, y = ave_N, group = Station)) +
  geom_segment(aes( x = Max_MLD, xend = Max_MLD, y = min(ave_N), yend = max(ave_N), group = Station ), colour = "#377EB8", linetype = 3, size = 1.5 ) +
  geom_segment(aes(y = redis_N_vol, yend = redis_N_vol, x = 0, xend = Max_MLD, group = Station ), colour = "black", linetype = 2, size = 1.5, alpha = 0.7 ) +
  geom_segment(aes(x = 100, xend = 100, y = min(ave_N), yend = max(ave_N), group = Station), colour = "black", linetype = 3, size = 1.5) +
  geom_errorbar(aes(x = Target_Z, ymin = ave_N - sd_N, ymax = ave_N + sd_N)) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
   labs(x = expression(italic(paste("Depth, m"))), y = expression(italic(paste("NO"[3],", µmol N L"^"-1"))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  guides(fill = F) +
  custom_theme() +
  facet_grid(Season~bin_plot+Station, scales = "free") +
  theme(panel.spacing.x = unit(1.5, "cm"),
        axis.text.x = element_text(angle = 90))

n2.plot
```

```{r include = FALSE}
ggsave("s1b.jpg", n2.plot, device = "jpg",  width = 25, height = 8, path = "~/Desktop/Export_MS/Submission2/") 
```


## DOC
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 20, fig.align = "center", warning = FALSE}
doc.plot <-  processed_export %>% 
  filter(Season == "Late Spring",
         Target_Z %in% c(0, 5, 10, 25, 50, 75, 100, 150, 200, 300, 400, 500, 750)) %>% 
  mutate(bin_plot = paste(degree_bin, "˚N", sep = "")) %>% 
  ggplot(aes(x = Target_Z, y = ave_DOC, group = Station)) +
  geom_segment(aes( x = Max_MLD, xend = Max_MLD, y = min(ave_DOC), yend = max(ave_DOC), group = Station ), colour = "#377EB8", linetype = 3, size = 1.5 ) +
  geom_segment(aes(y = redis_DOC_vol, yend = redis_DOC_vol, x = 0, xend = Max_MLD, group = Station ), colour = "black", linetype = 2, size = 1.5, alpha = 0.7 ) +
  geom_segment(aes(x = 100, xend = 100, y = min(ave_DOC), yend = max(ave_DOC), group = Station), colour = "black", linetype = 3, size = 1.5) +
  geom_errorbar(aes(x = Target_Z, ymin = ave_DOC - sd_DOC, ymax = ave_DOC + sd_DOC)) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  labs(x = expression(italic(paste("Depth, m"))), y = expression(italic(paste("DOC, µmol C L"^"-1"))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  guides(fill = F) +
  custom_theme() +
  facet_grid(Season~bin_plot+Station, scales = "free") +
  theme(panel.spacing.x = unit(1, "cm"),
        axis.text.x = element_text(angle = 90))

doc.plot
```

```{r include = FALSE}
#ggsave("s2a.jpg", doc.plot, device = "jpg",  width = 20, height = 8, path = "~/Desktop/Export_MS/Submission2/") 
```

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 35, fig.align = "center", warning = FALSE}
doc1.plot <-  processed_export %>% 
  filter(Season == "Early Autumn",
         Target_Z %in% c(0, 5, 10, 25, 50, 75, 100, 150, 200, 300, 400, 500, 750)) %>% 
  mutate(bin_plot = paste(degree_bin, "˚N", sep = "")) %>% 
  ggplot(aes(x = Target_Z, y = ave_DOC, group = Station)) +
   geom_segment(aes( x = Max_MLD, xend = Max_MLD, y = min(ave_DOC), yend = max(ave_DOC), group = Station ), colour = "#377EB8", linetype = 3, size = 1.5 ) +
  geom_segment(aes(y = redis_DOC_vol, yend = redis_DOC_vol, x = 0, xend = Max_MLD, group = Station ), colour = "black", linetype = 2, size = 1.5, alpha = 0.7 ) +
  geom_segment(aes(x = 100, xend = 100, y = min(ave_DOC), yend = max(ave_DOC), group = Station), colour = "black", linetype = 3, size = 1.5) +
  geom_errorbar(aes(x = Target_Z, ymin = ave_DOC - sd_DOC, ymax = ave_DOC + sd_DOC)) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  labs(x = expression(italic(paste("Depth, m"))), y = expression(italic(paste("DOC, µmol C L"^"-1"))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  guides(fill = F) +
  custom_theme() +
  facet_grid(Season~bin_plot+Station, scales = "free") +
  theme(panel.spacing.x = unit(1.5, "cm"),
        axis.text.x = element_text(angle = 90))

doc1.plot
```

```{r include = FALSE}
#ggsave("s2b.jpg", doc1.plot, device = "jpg",  width = 29, height = 8, path = "~/Desktop/Export_MS/Submission2/") 
```

## Silicate

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 20, fig.align = "center", warning = FALSE}
si.plot <-  processed_export %>% 
  filter(Season == "Late Spring",
         Target_Z %in% c(0, 5, 10, 25, 50, 75, 100, 150, 200, 300, 400, 500, 750)) %>% 
  mutate(bin_plot = paste(degree_bin, "˚N", sep = "")) %>% 
  ggplot(aes(x = Target_Z, y = ave_Si, group = Station)) +
 geom_segment(aes( x = Max_MLD, xend = Max_MLD, y = min(ave_Si), yend = max(ave_Si), group = Station ), colour = "#377EB8", linetype = 3, size = 1.5 ) +
  geom_segment(aes(y = redis_Si_vol, yend = redis_Si_vol, x = 0, xend = Max_MLD, group = Station ), colour = "black", linetype = 2, size = 1.5, alpha = 0.7 ) +
  geom_segment(aes(x = 100, xend = 100, y = min(ave_Si), yend = max(ave_Si), group = Station), colour = "black", linetype = 3, size = 1.5) +
  geom_errorbar(aes(x = Target_Z, ymin = ave_Si - sd_Si, ymax = ave_Si + sd_Si)) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  labs(x = expression(italic(paste("Depth, m"))), y = expression(italic(paste("SiO"[4],", µmol Si L"^"-1"))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  guides(fill = F) +
  custom_theme() +
   facet_grid(Season~bin_plot+Station, scales = "free") +
  theme(panel.spacing.x = unit(1.5, "cm"),
        axis.text.x = element_text(angle = 90))

si.plot
```

```{r include = FALSE}
#ggsave("s3a.jpg", si.plot, device = "jpg",  width = 20, height = 8, path = "~/Desktop/Export_MS/Submission2/") 
```

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 34, fig.align = "center", warning = FALSE}
si2.plot <-  processed_export %>% 
  filter(Season == "Early Autumn",
         Target_Z %in% c(0, 5, 10, 25, 50, 75, 100, 150, 200, 300, 400, 500, 750)) %>% 
  mutate(bin_plot = paste(degree_bin, "˚N", sep = "")) %>% 
  ggplot(aes(x = Target_Z, y = ave_Si, group = Station)) +
  geom_segment(aes( x = Max_MLD, xend = Max_MLD, y = min(ave_Si), yend = max(ave_Si), group = Station ), colour = "#377EB8", linetype = 3, size = 1.5 ) +
  geom_segment(aes(y = redis_Si_vol, yend = redis_Si_vol, x = 0, xend = Max_MLD, group = Station ), colour = "black", linetype = 2, size = 1.5, alpha = 0.7 ) +
  geom_segment(aes(x = 100, xend = 100, y = min(ave_Si), yend = max(ave_Si), group = Station), colour = "black", linetype = 3, size = 1.5) +
  geom_errorbar(aes(x = Target_Z, ymin = ave_Si - sd_Si, ymax = ave_Si + sd_Si)) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  labs(x = expression(italic(paste("Depth, m"))), y = expression(italic(paste("SiO"[4],", µmol Si L"^"-1"))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  guides(fill = F) +
  custom_theme() +
   facet_grid(Season~bin_plot+Station, scales = "free") +
  theme(panel.spacing.x = unit(1.5, "cm"),
        axis.text.x = element_text(angle = 90))

si2.plot
```

```{r include = FALSE}
#ggsave("s3b.jpg", si2.plot, device = "jpg",  width = 25, height = 8, path = "~/Desktop/Export_MS/Submission2/") 
```

## NCP

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 20, fig.align = "center", warning = FALSE}
ncp.plot <-  processed_export %>% 
  filter(Season == "Late Spring", 
         Target_Z %in% c(0, 5, 10, 25, 50, 75, 100)) %>% 
  mutate(bin_plot = paste(degree_bin, "˚N", sep = "")) %>% 
  ggplot(aes(x = Target_Z, y = NCP_umol, group = Station)) +
   geom_segment(aes(y = min(NCP_umol), yend = max(NCP_umol), x = ave_chlmax, xend = ave_chlmax, group = Station),colour = "#377EB8", linetype = 2, size = 1.5 , alpha = 0.7) +
  geom_segment(aes(y = min(NCP_umol), yend = max(NCP_umol), x = ave_pmax, xend = ave_pmax, group = Station), colour = "#FF7F00", linetype = 3, size = 1.5, alpha = 0.7 ) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  labs(x = expression(italic(paste("Depth, m"))), y = expression(italic(paste("NCP, µmol C"," ", "L"^"-1"))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  guides(fill = F) +
  custom_theme() +
  facet_grid(Season~bin_plot+Station, scales = "free") +
  theme(panel.spacing.x = unit(1, "cm"),
        axis.text.x = element_text(angle = 90))

ncp.plot
```
```{r include = FALSE}
ggsave("s4a.jpg", ncp.plot, device = "jpg",  width = 20, height = 8, path = "~/Desktop/Export_MS/Submission2/") 
```

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 30, fig.align = "center", warning = FALSE}
ncp2.plot <-  processed_export %>% 
  filter(Season == "Early Autumn", 
         Target_Z %in% c(0, 5, 10, 25, 50, 75, 100)) %>% 
  mutate(bin_plot = paste(degree_bin, "˚N", sep = "")) %>% 
  ggplot(aes(x = Target_Z, y = NCP_umol, group = Station)) +
  geom_segment(aes(y = min(NCP_umol), yend = max(NCP_umol), x = ave_chlmax, xend = ave_chlmax, group = Station),colour = "#377EB8", linetype = 2, size = 1.5 , alpha = 0.7) +
  geom_segment(aes(y = min(NCP_umol), yend = max(NCP_umol), x = ave_pmax, xend = ave_pmax, group = Station), colour = "#FF7F00", linetype = 3, size = 1.5, alpha = 0.7 ) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
   labs(x = expression(italic(paste("Depth, m"))), y = expression(italic(paste("NCP, µmol C"," ", "L"^"-1"))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  guides(fill = F) +
  custom_theme() +
  facet_grid(Season~bin_plot+Station, scales = "free") +
  theme(panel.spacing.x = unit(1, "cm"),
        axis.text.x = element_text(angle = 90))

ncp2.plot
```

```{r include = FALSE}
ggsave("s4b.jpg", ncp2.plot, device = "jpg",  width = 25, height = 8, path = "~/Desktop/Export_MS/Submission2/") 
```

## ∆DOC

```{r fig.align = "center", fig.height = 8, fig.width = 20, echo = FALSE, message=FALSE, warning=FALSE}
ddoc.plot <-  processed_export %>% 
  drop_na(delta_DOC) %>% 
  filter(Season == "Late Spring", 
         Target_Z %in% c(0, 5, 10, 25, 50, 75, 100)) %>% 
  mutate(bin_plot = paste(degree_bin, "˚N", sep = "")) %>% 
  ggplot(aes(x = Target_Z, y = delta_DOC, group = Station)) +
   geom_segment(aes(y = min(delta_DOC), yend = max(delta_DOC), x = ave_chlmax, xend = ave_chlmax, group = Station),colour = "#377EB8", linetype = 2, size = 1.5 , alpha = 0.7) +
  geom_segment(aes(y = min(delta_DOC), yend = max(delta_DOC), x = ave_pmax, xend = ave_pmax, group = Station), colour = "#FF7F00", linetype = 3, size = 1.5, alpha = 0.7 ) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  labs(x = expression(paste(italic("Depth, m"))), y = expression(italic(paste("∆DOC, µmol C"," ", "L"^"-1"))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  guides(fill = F) +
  custom_theme() +
  facet_grid(Season~bin_plot+Station, scales = "free") +
  theme(panel.spacing.x = unit(1, "cm"),
        axis.text.x = element_text(angle = 90))
  
ddoc.plot
```

```{r include = FALSE}
ggsave("s5a.jpg", ddoc.plot, device = "jpg",  width = 20, height = 8, path = "~/Desktop/Export_MS/Submission2/") 
```

```{r fig.align = "center", fig.height = 8, fig.width = 33, echo = FALSE, message=FALSE, warning=FALSE}
ddoc2.plot <-  processed_export %>% 
  drop_na(delta_DOC) %>% 
  filter(Season == "Early Autumn", 
         Target_Z %in% c(0, 5, 10, 25, 50, 75, 100)) %>% 
  mutate(bin_plot = paste(degree_bin, "˚N", sep = "")) %>% 
  ggplot(aes(x = Target_Z, y = delta_DOC, group = Station)) +
 geom_segment(aes(y = min(delta_DOC), yend = max(delta_DOC), x = ave_chlmax, xend = ave_chlmax, group = Station),colour = "#377EB8", linetype = 2, size = 1.5 , alpha = 0.7) +
  geom_segment(aes(y = min(delta_DOC), yend = max(delta_DOC), x = ave_pmax, xend = ave_pmax, group = Station), colour = "#FF7F00", linetype = 3, size = 1.5, alpha = 0.7 ) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  labs(x = expression(paste(italic("Depth, m"))), y = expression(italic(paste("∆DOC, µmol C"," ", "L"^"-1"))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  guides(fill = F) +
  custom_theme() +
  facet_grid(Season~bin_plot+Station, scales = "free") +
  theme(panel.spacing.x = unit(1.5, "cm"),
        axis.text.x = element_text(angle = 90))
  
ddoc2.plot
```

```{r include = FALSE}
ggsave("s5b.jpg", ddoc2.plot, device = "jpg",  width = 25, height = 8, path = "~/Desktop/Export_MS/Submission2/") 
```

## ∆DOC:NCP

```{r fig.align="center", fig.height=8, fig.width=24, echo = FALSE, message=FALSE, warning=FALSE}
docncp.plot <-  processed_export %>% 
   filter(Season == "Late Spring", 
         Target_Z %in% c(0, 5, 10, 25, 50, 75, 100)) %>% 
  mutate(bin_plot = paste(degree_bin, "˚N", sep = "")) %>% 
  ggplot(aes(x = Target_Z, y = doc_ncp, group = Station)) +
  geom_segment(aes(y = min(doc_ncp), yend = max(doc_ncp), x = ave_chlmax, xend = ave_chlmax, group = Station),colour = "#377EB8", linetype = 2, size = 1.5 , alpha = 0.7) +
  geom_segment(aes(y = min(doc_ncp), yend = max(doc_ncp), x = ave_pmax, xend = ave_pmax, group = Station), colour = "#FF7F00", linetype = 3, size = 1.5, alpha = 0.7 ) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  labs(x = expression(paste(italic("Depth, m"))), y = expression(italic(paste("∆DOC:NCP"))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  guides(fill = F) +
  custom_theme() +
  facet_grid(Season~bin_plot+Station, scales = "free") +
  theme(panel.spacing.x = unit(1, "cm"),
        axis.text.x = element_text(angle = 90))

docncp.plot
```
```{r include = FALSE}
ggsave("s6a.jpg", docncp.plot, device = "jpg",  width = 20, height = 8, path = "~/Desktop/Export_MS/Submission2/") 
```


```{r fig.align="center", fig.height=8, fig.width=35, echo = FALSE, message=FALSE, warning=FALSE}
docncp2.plot <-  processed_export %>% 
   filter(Season == "Early Autumn", 
         Target_Z %in% c(0, 5, 10, 25, 50, 75, 100)) %>% 
  mutate(bin_plot = paste(degree_bin, "˚N", sep = "")) %>% 
  ggplot(aes(x = Target_Z, y = doc_ncp, group = Station)) +
    geom_segment(aes(y = min(doc_ncp), yend = max(doc_ncp), x = ave_chlmax, xend = ave_chlmax, group = Station),colour = "#377EB8", linetype = 2, size = 1.5 , alpha = 0.7) +
  geom_segment(aes(y = min(doc_ncp), yend = max(doc_ncp), x = ave_pmax, xend = ave_pmax, group = Station), colour = "#FF7F00", linetype = 3, size = 1.5, alpha = 0.7 ) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  labs(x = expression(paste(italic("Depth, m"))), y = expression(italic(paste("∆DOC:NCP"))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  guides(fill = F) +
  custom_theme() +
  facet_grid(Season~bin_plot+Station, scales = "free") +
  theme(panel.spacing.x = unit(1.5, "cm"),
        axis.text.x = element_text(angle = 90))

docncp2.plot
```

```{r include = FALSE}
ggsave("s6b.jpg", docncp2.plot, device = "jpg",  width = 27, height = 8, path = "~/Desktop/Export_MS/Submission2/") 
```


## Density

```{r fig.align="center", fig.height=8, fig.width=31, echo = FALSE, message=FALSE, warning=FALSE}
density.plot <-  processed_export %>% 
   filter(Season == "Late Spring", 
         Target_Z %in% c(0, 5, 10, 25, 50, 75, 100)) %>% 
  mutate(bin_plot = paste(degree_bin, "˚N", sep = "")) %>% 
  ggplot(aes(x = Target_Z, y = ave_p, group = Station)) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  geom_errorbar(aes(x = Target_Z, ymin = ave_p - sd_p, ymax = ave_p + sd_p)) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  labs(x = expression(paste(italic("Depth, m"))), y = expression(italic(paste("Density, kg m"^"-3"))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  guides(fill = F) +
  custom_theme() +
  facet_grid(Season~bin_plot+Station, scales = "free") +
  theme(panel.spacing.x = unit(1.5, "cm"),
        axis.text.x = element_text(angle = 90))

density.plot
```

```{r include = FALSE}
ggsave("s7a.jpg", density.plot, device = "jpg",  width = 20, height = 8, path = "~/Desktop/Export_MS/Submission2/") 
```


```{r fig.align="center", fig.height=8, fig.width=34, echo = FALSE, message=FALSE, warning=FALSE}
density2.plot <-  processed_export %>% 
   filter(Season == "Early Autumn", 
         Target_Z %in% c(0, 5, 10, 25, 50, 75, 100)) %>% 
  mutate(bin_plot = paste(degree_bin, "˚N", sep = "")) %>% 
  ggplot(aes(x = Target_Z, y = ave_p, group = Station)) +
  geom_errorbar(aes(x = Target_Z, ymin = ave_p - sd_p, ymax = ave_p + sd_p)) +
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  geom_line(aes(colour = Season), size = 0.7) +
  geom_point(aes(fill = Season), size = 6, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  labs(x = expression(paste(italic("Depth, m"))), y = expression(italic(paste("Density, kg m"^"-3"))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  guides(fill = F) +
  custom_theme() +
  facet_grid(Season~bin_plot+Station, scales = "free") +
  theme(panel.spacing.x = unit(1.5, "cm"),
        axis.text.x = element_text(angle = 90))

density2.plot
```

```{r include = FALSE}
ggsave("s7b.jpg", density2.plot, device = "jpg",  width = 25, height = 8, path = "~/Desktop/Export_MS/Submission2/") 
```
